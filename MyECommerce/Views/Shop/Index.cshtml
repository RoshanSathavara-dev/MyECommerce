@model IEnumerable<MyECommerce.Models.Product>

@{
    ViewData["Title"] = "Shop";
}


<!--breadcrumb section start-->
<div class="breadcrumb-section pt-40 pb-40">
    <div class="container-1700">
        <p class="breadcrumb-text mb-0"><a href="index.html">Home</a> / <span class="text-main-color">Shop</span></p>
    </div>
</div>
<!--breadcrumb section end-->
<!--shop section start-->
<section class="shop-section bg-white ptb-120">
    <div class="container">
        <div class="row g-4">
            <div class="col-xl-3 order-2 order-xl-1">
                <div class="shop-sidebar pe-xl-5 mt-5 mt-xl-0">
                    <!-- ✅ Search Box -->
                    <div class="sidebar-widget search-widget">
                        <form>
                            <input type="text" id="searchInput" placeholder="Search Here..." class="theme-input fw-light">
                        </form>
                    </div>
                    <!-- ✅ Categories -->
                    <div class="sidebar-widget categories-widget mt-60">
                        <h4 class="widget-title position-relative fw-normal mb-5">Categories</h4>
                        <ul class="sidebar-check-fields">
                            @foreach (var category in ViewBag.Categories)
                            {
                                <li>
                                    <label>
                                        <input type="checkbox" class="category-filter" value="@category.Id">
                                        <span>@category.Name</span>
                                    </label>
                                </li>
                            }
                        </ul>
                    </div>
                    <div class="sidebar-widget filter-widget mt-60">
                        <h4 class="widget-title position-relative mb-5">Filter by price</h4>
                        <div class="ur-pricing-range"></div>

                        <form action="#" class="d-flex align-items-center justify-content-between mt-4">
                            <p class="mb-0">
                                <label for="amount">Price:</label>
                                <input type="text" id="amount" readonly>
                            </p>
                            <button type="submit" class="submit-btn">Filter<span class="ms-2"><i class="fas fa-arrow-right"></i></span></button>
                        </form>
                    </div>

                    <div class="sidebar-widget color-select-widget mt-40">
                        <h4 class="widget-title position-relative mb-5">Select Color</h4>
                        <ul class="color-select">
                            <li><label><input type="checkbox" class="color-filter" value="Soft Gold"><span class="bg-soft-gold">Soft Gold <span>(12)</span></span></label></li>
                            <li><label><input type="checkbox" class="color-filter" value="Light Pink"><span class="bg-light-pink">Light Pink <span>(05)</span></span></label></li>
                            <li><label><input type="checkbox" class="color-filter" value="Green Touch"><span class="bg-green-touch">Green Touch <span>(02)</span></span></label></li>
                            <li><label><input type="checkbox" class="color-filter" value="Navy Blue"><span class="bg-navy-blue">Navy Blue <span>(05)</span></span></label></li>
                            <li><label><input type="checkbox" class="color-filter" value="Gray White"><span class="bg-gray-white">Gray White <span>(16)</span></span></label></li>
                        </ul>
                    </div>
                    <div class="sidebar-widget brand-widget mt-60">
                        <h4 class="widget-title position-relative fw-normal mb-5">Brands</h4>
                        <ul class="sidebar-check-fields">
                            <li><label><input type="checkbox"> <span>Juliate <span>(09)</span></span></label></li>
                            <li><label><input type="checkbox"> <span>H&M <span>(50)</span></span></label></li>
                            <li><label><input type="checkbox"> <span>Macro <span>(08)</span></span></label></li>
                            <li><label><input type="checkbox"> <span>Harmoni <span>(13)</span></span></label></li>
                            <li><label><input type="checkbox"> <span>Sowat <span>(03)</span></span></label></li>
                        </ul>
                    </div>
                    <div class="sidebar-widget products-widget mt-60">
                        <h4 class="widget-title position-relative mb-5">Latest Products</h4>
                        <ul class="sidebar-products">
                            @if (ViewBag.LatestProducts is List<MyECommerce.Models.Product> latestProducts && latestProducts.Any())
                            {
                                @foreach (var product in latestProducts)
                                {
                                    <li class="d-flex align-items-center gap-4">
                                        <div class="flex-shrink-0 thumbnail light-bg p-3">
                                            <a href="@Url.Action("Details", "Product", new { id = product.Id })">
                                                <img src="@product.ImageUrl" alt="@product.Name" class="img-fluid">
                                            </a>
                                        </div>
                                        <div>
                                            <a href="@Url.Action("Details", "Product", new { id = product.Id })">
                                                <h6 class="mb-3">@product.Name</h6>
                                            </a>
                                            <span class="price primary-text-color">$@product.Price</span>
                                        </div>
                                    </li>
                                }
                            }
                            else
                            {
                                <li class="text-center text-muted">No latest products available.</li>
                            }
                        </ul>
                    </div>


                </div>
            </div>

            <div class="col-xl-9 order-1 order-xl-2">
                <div class="shop-grid">
                    <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
                        <p class="mb-0 fw-light">Showing 1-12 of @Model.Count() results</p>
                        <div class="d-flex align-items-center gap-4">
                            <div class="select-wrapper">
                                <select class="nice_select">
                                    <option>Default Sorting</option>
                                    <option>Sort by Price</option>
                                    <option>Sort by Popularity</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="products-grid mt-40">
                        <div class="row g-4" id="productList">
                            @foreach (var product in Model)
                            {
                                <div class="col-lg-4 col-md-6">
                                    <div class="vr5-product-card">
                                        <div class="feature-image position-relative h-300">
                                            <img src="@product.ImageUrl" alt="@product.Name" class="img-fluid">
                                            <div class="action-box">
                                                <a href="#" class="cart-btn">Add to Cart</a>
                                                <div class="action-btns">
                                                    <a href="#" class="wishlist-btn">
                                                        <i class="fa-regular fa-heart"></i>
                                                    </a>
                                                    <!-- ✅ Quick View Button -->
                                                    <a href="#" class="quick-view-btn" data-bs-toggle="modal" data-bs-target="#product_view"
                                                       data-id="@product.Id"
                                                       data-name="@product.Name"
                                                       data-image="@product.ImageUrl"
                                                       data-price="@product.Price"
                                                       data-description="@product.Description">
                                                        <svg width="17" height="13" viewBox="0 0 17 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M12.375 6.75C12.375 8.69141 10.7891 10.25 8.875 10.25C6.93359 10.25 5.375 8.69141 5.375 6.75C5.375 4.83594 6.93359 3.25 8.875 3.25C10.7891 3.25 12.375 4.83594 12.375 6.75ZM8.875 4.125C7.39844 4.125 6.25 5.30078 6.25 6.75C6.25 8.19922 7.39844 9.375 8.875 9.375C10.3242 9.375 11.5 8.19922 11.5 6.75C11.5 5.30078 10.3242 4.125 8.875 4.125ZM14.125 2.83984C15.4102 4.01562 16.2578 5.4375 16.668 6.42188C16.75 6.64062 16.75 6.88672 16.668 7.10547C16.2578 8.0625 15.4102 9.48438 14.125 10.6875C12.8398 11.8906 11.0625 12.875 8.875 12.875C6.66016 12.875 4.88281 11.8906 3.59766 10.6875C2.3125 9.48438 1.46484 8.0625 1.05469 7.10547C0.972656 6.88672 0.972656 6.64062 1.05469 6.42188C1.46484 5.4375 2.3125 4.01562 3.59766 2.83984C4.88281 1.63672 6.66016 0.625 8.875 0.625C11.0625 0.625 12.8398 1.63672 14.125 2.83984ZM1.875 6.75C2.23047 7.625 3.02344 8.9375 4.19922 10.0312C5.375 11.125 6.93359 12 8.875 12C10.7891 12 12.3477 11.125 13.5234 10.0312C14.6992 8.9375 15.4922 7.625 15.875 6.75C15.4922 5.875 14.6992 4.5625 13.5234 3.46875C12.3477 2.375 10.7891 1.5 8.875 1.5C6.93359 1.5 5.375 2.375 4.19922 3.46875C3.02344 4.5625 2.23047 5.875 1.875 6.75Z" fill="#121111" />
                                                        </svg>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="product-content">
                                            <span class="fw-semibold subtitle text-uppercase">@product?.Category?.Name</span>
                                            @if (product != null && product.Id > 0)
                                            {
                                                <a asp-action="Details" asp-controller="Product" asp-route-id="@product.Id">
                                                    <h6 class="fw-semibold mt-3">@product.Name</h6>
                                                </a>
                                            }
                                            <!-- ✅ Truncate description -->
                                            <p class="fs-sm mb-4 text-truncate" style="max-height: 50px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                                @product?.Description
                                            </p>

                                            <span class="text-main-color fw-bold fs-sm">$@product?.Price</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <!-- ✅ Pagination Section -->
                    <div class="text-center mt-60">
                        <ul class="template-pagination d-inline-flex align-items-center gap-3" id="paginationContainer">
                            @for (int i = 1; i <= ViewBag.TotalPages; i++)
                            {
                                <li>
                                    <a href="#" class="pagination-link @(ViewBag.CurrentPage == i ? "active" : "")" data-page="@i">
                                        @i
                                    </a>
                                </li>
                            }

                            @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                            {
                                <li>
                                    <a href="#" class="pagination-link" data-page="@(ViewBag.CurrentPage + 1)">
                                        <i class="fa-solid fa-angles-right"></i>
                                    </a>
                                </li>
                            }
                        </ul>
                    </div>



                </div>
            </div>
        </div>
    </div>
</section>
<!--shop section end-->
<!-- ✅ Quick View Modal -->
<div class="modal fade" id="product_view" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            <div class="row">
                <!-- ✅ Product Image -->
                <div class="col-xl-6">
                    <div class="vr-product-double-slider">
                        <div class="vr-product-thumb position-relative">
                            <span class="badge sale-badge">Sale</span>
                            <div class="vr-product-thumb position-relative">
                                <img id="modalProductImage" src="" alt="product" class="img-fluid">
                            </div>

                        </div>
                    </div>
                </div>

                <!-- ✅ Product Details -->
                <div class="col-xl-6">
                    <div class="vr-product-details-content mt-5 mt-xl-0">
                        <h3 id="modalProductName" class="mb-4 fw-semibold"></h3>
                        <div class="product-rating">
                            <ul class="rating-star d-inline-flex">
                                <li><i class="fas fa-star"></i></li>
                                <li><i class="fas fa-star"></i></li>
                                <li><i class="fas fa-star"></i></li>
                                <li><i class="fas fa-star"></i></li>
                                <li><i class="fas fa-star"></i></li>
                            </ul>
                            <span class="fs-sm">(3 Customer Reviews)</span>
                        </div>
                        <h5 id="modalProductPrice" class="mb-0 mt-30 text-main-color"></h5>
                        <p id="modalProductDescription" class="mb-40 mt-30"></p>

                        <!-- ✅ Quantity & Buttons -->
                        <div class="d-flex align-items-center mt-30 gap-3">
                            <div class="quantity-box">
                                <button type="button" class="decrement"><i class="fa-solid fa-minus"></i></button>
                                <input type="text" value="1">
                                <button type="button" class="increment"><i class="fa-solid fa-plus"></i></button>
                            </div>
                            <a href="#" class="template-btn primary-btn fs-sm text-uppercase h-40">ADD To Cart</a>
                        </div>
                        <a href="#" class="pd-wishlist-btn text-uppercase mt-30"><i class="fa-regular fa-heart"></i> ADD Wishlist</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--modal End-->
<!-- ✅ JavaScript to Fill Modal -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".quick-view-btn").forEach(button => {
            button.addEventListener("click", function () {
                const name = this.getAttribute("data-name");
                const image = this.getAttribute("data-image");
                const price = this.getAttribute("data-price");
                const description = this.getAttribute("data-description");

                document.getElementById("modalProductName").textContent = name;
                document.getElementById("modalProductImage").src = image;
                document.getElementById("modalProductPrice").textContent = "$" + price;
                document.getElementById("modalProductDescription").textContent = description;
            });
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        let searchInput = document.getElementById("searchInput");

        // ✅ Initialize the Price Range Slider (NO automatic filtering)
        $(".ur-pricing-range").slider({
            range: true,
            min: 0,
            max: 50000, // Adjust max price as needed
            values: [0, 50000], // Default price range
            slide: function (event, ui) {
                $("#amount").val("$" + ui.values[0] + " - $" + ui.values[1]);
            }
        });

        $("#amount").val("$" + $(".ur-pricing-range").slider("values", 0) +
            " - $" + $(".ur-pricing-range").slider("values", 1));

        // ✅ Attach event listener to Filter button ONLY for price filtering
        document.querySelector(".submit-btn").addEventListener("click", function (event) {
            event.preventDefault();
            filterProducts(true);
        });

        // ✅ Attach event listeners for Search & Category Filters
        searchInput.addEventListener("input", function () {
            filterProducts(false);
        });

        document.querySelectorAll(".category-filter").forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                filterProducts(false);
            });
        });

        document.querySelectorAll(".color-filter").forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                filterProducts(false);
            });
        });

        function filterProducts(applyPriceFilter, page = 1) {
            let searchValue = searchInput.value.trim();
            let selectedCategories = [];
            let selectedColors = [];
            let selectedSizes = [];

            document.querySelectorAll(".category-filter:checked").forEach(checkbox => {
                selectedCategories.push(checkbox.value);
            });

            document.querySelectorAll(".color-filter:checked").forEach(checkbox => {
                selectedColors.push(checkbox.value);
            });

            document.querySelectorAll(".size-filter:checked").forEach(checkbox => {
                selectedSizes.push(checkbox.value);
            });

            let queryString = `?search=${encodeURIComponent(searchValue)}&page=${page}`;
            if (selectedCategories.length > 0) queryString += `&categoryIds=${selectedCategories.join(",")}`;
            if (selectedColors.length > 0) queryString += `&colors=${selectedColors.join(",")}`;
            if (selectedSizes.length > 0) queryString += `&sizes=${selectedSizes.join(",")}`;

            if (applyPriceFilter) {
                let minPrice = $(".ur-pricing-range").slider("values", 0);
                let maxPrice = $(".ur-pricing-range").slider("values", 1);
                queryString += `&minPrice=${minPrice}&maxPrice=${maxPrice}`;
            }

            fetch("/Shop/Index" + queryString, { headers: { "X-Requested-With": "XMLHttpRequest" } })
                .then(response => response.json())
                .then(data => {
                    updateProductGrid(data.products, data.totalPages, page);
                })
                .catch(error => console.error("Error fetching products:", error));
        }

        function updateProductGrid(products, totalPages, currentPage) {
            let productGrid = document.getElementById("productList");
            let paginationContainer = document.querySelector(".template-pagination");

            productGrid.innerHTML = ""; // ✅ Clear current products
            paginationContainer.innerHTML = ""; // ✅ Clear pagination

            if (!Array.isArray(products) || products.length === 0) {
                productGrid.innerHTML = "<p class='text-center'>No products found</p>";
                return;
            }

            products.forEach(product => {
                let productHTML = `
                    <div class="col-lg-4 col-md-6">
                        <div class="vr5-product-card">
                            <div class="feature-image position-relative h-300">
                                <img src="${product.imageUrl || 'default.jpg'}" alt="${product.name || 'No Name'}" class="img-fluid">
                                <div class="action-box">
                                    <a href="#" class="cart-btn">Add to Cart</a>
                                    <div class="action-btns">
                                        <a href="#" class="wishlist-btn"><i class="fa-regular fa-heart"></i></a>
                                        <a href="#" class="quick-view-btn" data-bs-toggle="modal" data-bs-target="#product_view"
                                           data-name="${product.name || 'No Name'}"
                                           data-image="${product.imageUrl || 'default.jpg'}"
                                           data-price="${product.price !== null ? product.price : 'N/A'}"
                                           data-description="${product.description || 'No description'}">
                                            <i class="fa-solid fa-eye"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="product-content">
                                <span class="fw-semibold subtitle text-uppercase">${product.categoryName || 'Uncategorized'}</span>
                                <a href="#"><h6 class="fw-semibold mt-3">${product.name || 'No Name'}</h6></a>
                                <p class="fs-sm mb-4">${product.description || 'No description'}</p>
                                <span class="text-main-color fw-bold fs-sm">$${product.price !== null ? product.price : 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                `;

                productGrid.innerHTML += productHTML;
            });

            // ✅ Generate Pagination UI
            for (let i = 1; i <= totalPages; i++) {
                paginationContainer.innerHTML += `
                    <li><a href="#" class="pagination-link ${(i === currentPage ? "active" : "")}" data-page="${i}">${i}</a></li>
                `;
            }

            document.querySelectorAll(".pagination-link").forEach(link => {
                link.addEventListener("click", function (event) {
                    event.preventDefault();
                    let page = this.getAttribute("data-page");
                    filterProducts(false, page); // ✅ Now updates page without reloading
                });
            });

            attachQuickViewEventListeners();
        }

        function attachQuickViewEventListeners() {
            document.querySelectorAll(".quick-view-btn").forEach(button => {
                button.addEventListener("click", function () {
                    const name = this.getAttribute("data-name");
                    const image = this.getAttribute("data-image");
                    const price = this.getAttribute("data-price");
                    const description = this.getAttribute("data-description");

                    document.getElementById("modalProductName").textContent = name;
                    document.getElementById("modalProductImage").src = image;
                    document.getElementById("modalProductPrice").textContent = "$" + price;
                    document.getElementById("modalProductDescription").textContent = description;
                });
            });
        }

        // ✅ Attach event listener to pagination links
        document.querySelectorAll(".pagination-link").forEach(link => {
            link.addEventListener("click", function (event) {
                event.preventDefault();
                let page = this.getAttribute("data-page");
                filterProducts(false, page);
            });
        });
    });


    </script>




<style>
    .vr5-product-card .feature-image img {
        width: 100%; /* Make image fill the container width */
        height: 250px; /* Set a fixed height */
        object-fit: cover; /* Ensures image fits without stretching */
        border-radius: 5px; /* Optional: Adds rounded corners */
    }

    #modalProductImage {
        width: 100%; /* Ensures the image fills the modal */
        height: 300px; /* Set a fixed height */
        object-fit: cover; /* Prevents stretching */
        border-radius: 5px; /* Optional: Adds smooth edges */
    }



</style>
