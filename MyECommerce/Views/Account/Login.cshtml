@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Login";

}



<!--breadcrumb section start-->
<div class="breadcrumb-section pt-40 pb-40">
    <div class="container-1700">
        <p class="breadcrumb-text mb-0"><a href="index.html">Home</a> / <span class="text-main-color">Login</span></p>
    </div>
</div>
<!--breadcrumb section end-->
<!--login area start-->
<div class="login-area ptb-120 bg-white">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-6">
                <form class="theme-form" id="otpLoginForm">
                    <h3 class="mb-40">Login Account</h3>

                    <!-- ✅ Store returnUrl in a hidden field -->
                    <input type="hidden" id="returnUrl" value="@ViewBag.ReturnUrl" />

                    <div id="loginFields">
                        <input type="text" id="EmailOrContact" placeholder="User name or email address*" class="theme-input" required>
                        <button type="button" id="sendOtpButton" class="template-btn primary-btn w-100 mt-32"><span>Send OTP</span></button>
                    </div>

                    <div id="otpSection" style="display: none;">
                        <input type="text" id="OTP" placeholder="Enter OTP*" class="theme-input mt-3" required>
                        <button type="button" id="verifyLoginOtpButton" class="template-btn primary-btn w-100 mt-32"><span>Verify OTP</span></button>
                    </div>

                    <p class="mb-0 mt-32">Not registered yet? <a href="signup.html" class="text-main-color">Create an Account</a></p>
                </form> 
            </div>
        </div>
    </div>
</div>
<!--login area end-->

<script>
    document.getElementById("sendOtpButton").addEventListener("click", function () {
        var emailOrContact = document.getElementById("EmailOrContact").value.trim();
        var returnUrl = document.getElementById("returnUrl").value; // ✅ Get returnUrl

        if (!emailOrContact) {
            alert("Please enter your Email or Contact No.");
            return;
        }

        fetch('/Account/SendLoginOtp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ EmailOrContact: emailOrContact, returnUrl: returnUrl }) // ✅ Pass returnUrl
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("OTP sent successfully!");
                document.getElementById("loginFields").style.display = "none";
                document.getElementById("otpSection").style.display = "block";
            } else {
                alert("Failed to send OTP: " + data.message);
            }
        });
    });

    document.getElementById("verifyLoginOtpButton").addEventListener("click", function () {
        var otp = document.getElementById("OTP").value.trim();
        var emailOrContact = document.getElementById("EmailOrContact").value.trim();
        var returnUrl = document.getElementById("returnUrl").value; // ✅ Get returnUrl

        if (!otp) {
            alert("Please enter the OTP.");
            return;
        }

        fetch('/Account/VerifyLoginOtp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ otp: otp, EmailOrContact: emailOrContact, returnUrl: returnUrl }) // ✅ Pass returnUrl
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = data.redirectUrl; // ✅ Redirect to the correct page
            } else {
                alert("Invalid OTP: " + data.message);
            }
        });
    });
</script>