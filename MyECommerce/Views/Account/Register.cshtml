<!-- Register Section -->
<div class="login-area ptb-120 bg-white">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-6">
                <form id="registerForm" asp-controller="Account" asp-action="SendOtp" method="post" class="theme-form">
                    <h3 class="mb-40 text-center">Create Account</h3>

                    <!-- Name -->
                    <input type="text" id="Name" name="Name" class="theme-input" placeholder="Your Name" required>

                    <!-- Email -->
                    <input type="email" id="Email" name="Email" class="theme-input mt-3" placeholder="Your Email" required>

                    <!-- Contact No -->
                    <input type="text" id="ContactNo" name="ContactNo" class="theme-input mt-3" placeholder="Contact No." required>


                    <!-- Register Button -->
                    <button type="button" id="sendOtpButton" class="template-btn primary-btn w-100 mt-32">
                        <span>Register</span>
                    </button>

                    <!-- OTP Section (Initially Hidden) -->
                    <div id="otpSection" style="display: none;">
                        <h3 class="mb-40 text-center">Enter OTP</h3>

                        <input type="text" id="otp" name="otp" class="theme-input mt-3" placeholder="Enter OTP" required>

                        <button type="button" id="verifyOtpButton" class="template-btn primary-btn w-100 mt-32">
                            <span>Verify & Complete Registration</span>
                        </button>
                    </div>




                    <p class="mb-0 mt-32 text-center">
                        Already have an account? <a href="Login" class="secondary-text-color">Login</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
          document.getElementById("sendOtpButton").addEventListener("click", function () {
        var name = document.getElementById("Name").value;
        var email = document.getElementById("Email").value;
        var contactNo = document.getElementById("ContactNo").value;
        var button = document.getElementById("sendOtpButton");

        if (!name.trim() || !email.trim() || !contactNo.trim()) {
            alert("Please fill in all details before proceeding.");
            return;
        }

        button.disabled = true;
        button.innerText = "Sending OTP...";

        fetch('/Account/SendOtp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ Name: name, Email: email, ContactNo: contactNo })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);  // Debugging purpose

            if (data.success) {
                alert("OTP sent successfully!");

                // Hide registration fields
                document.getElementById("Name").style.display = "none";
                document.getElementById("Email").style.display = "none";
                document.getElementById("ContactNo").style.display = "none";
                button.style.display = "none";  // Hide Register button

                // Show OTP input field
                document.getElementById("otpSection").style.display = "block";
            } else {
                alert("Failed to send OTP: " + data.message);
                button.disabled = false;
                button.innerText = "Register";
            }
        })
        .catch(error => {
            console.error("Error sending OTP:", error);
            button.disabled = false;
            button.innerText = "Register";
        });
    });



    document.getElementById("verifyOtpButton").addEventListener("click", function () {
        var otp = document.getElementById("otp").value;
        var button = document.getElementById("verifyOtpButton");

        if (!otp.trim()) {
            alert("Please enter the OTP.");
            return;
        }

        button.disabled = true;
        button.innerHTML = "Verifying...";

        fetch('/Account/VerifyOtp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ otp: otp })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("OTP verified successfully!");
                window.location.href = "/";
            } else {
                alert("Invalid OTP: " + data.message);
                button.disabled = false;
                button.innerHTML = "<span>Verify & Complete Registration</span>";
            }
        })
        .catch(error => {
            console.error("Error verifying OTP:", error);
            button.disabled = false;
            button.innerHTML = "<span>Verify & Complete Registration</span>";
        });
    });
</script>
